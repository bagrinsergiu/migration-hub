# TASK-008: Реализация отслеживания изменений имени Google таблицы

## Статус: ⏳ В ожидании

**Дата создания:** 2025-01-30  
**Приоритет:** Средний  
**Зависимости:** TASK-002, TASK-004

---

## Описание

Реализовать функционал отслеживания изменений имени Google таблицы. При каждом обращении к таблице нужно проверять, изменилось ли её название, и обновлять запись в БД.

## Что нужно сделать

### 1. Добавить метод в GoogleSheetsService

**Метод:** `trackSheetName($spreadsheetId)`

**Логика:**
1. Получить текущее название таблицы через Google API
2. Найти запись в таблице `google_sheets` по `spreadsheet_id`
3. Сравнить текущее название с сохраненным в БД
4. Если название изменилось:
   - Обновить `spreadsheet_name` в БД
   - Логировать изменение
   - Вернуть информацию об изменении
5. Если не изменилось, просто вернуть текущее название

### 2. Интегрировать отслеживание в методы работы с таблицами

Добавить вызов `trackSheetName()` в методы:
- `getSpreadsheet()`
- `syncSheet()`
- `linkSheetToWave()`

### 3. Добавить метод получения истории изменений (опционально)

**Метод:** `getSheetNameHistory($spreadsheetId)`

Если нужно хранить историю изменений, можно создать отдельную таблицу `google_sheets_name_history`.

---

## Ожидаемые результаты

### Проверка отслеживания изменений

- [ ] Метод `trackSheetName()` корректно получает название из Google API
- [ ] Название сравнивается с сохраненным в БД
- [ ] При изменении названия обновляется поле `spreadsheet_name`
- [ ] При изменении названия обновляется `updated_at`
- [ ] Изменение логируется с информацией: старое название, новое название, время

### Проверка интеграции

- [ ] Метод вызывается автоматически при `getSpreadsheet()`
- [ ] Метод вызывается автоматически при `syncSheet()`
- [ ] Метод вызывается автоматически при `linkSheetToWave()`
- [ ] Не вызывает ошибок, если таблица не найдена в БД

### Проверка обработки ошибок

- [ ] Если таблица недоступна, ошибка обрабатывается gracefully
- [ ] Если название не удалось получить, используется старое значение
- [ ] Все ошибки логируются

### Проверка производительности

- [ ] Проверка названия не замедляет основные операции
- [ ] Можно отключить отслеживание через конфигурацию (опционально)

---

## Связанные файлы

- `dashboard/api/services/GoogleSheetsService.php` - добавление метода `trackSheetName()`

---

## Примечания

- Отслеживание должно быть ненавязчивым и не влиять на производительность
- Можно добавить флаг в конфигурацию для включения/отключения отслеживания
- Если нужна история изменений, можно создать отдельную таблицу
