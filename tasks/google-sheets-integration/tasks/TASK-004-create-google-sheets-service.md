# TASK-004: Создание GoogleSheetsService

## Статус: ⏳ В ожидании

**Дата создания:** 2025-01-30  
**Приоритет:** Критический  
**Зависимости:** TASK-001, TASK-003

---

## Описание

Создать сервис для работы с Google Sheets API. Сервис должен обеспечивать аутентификацию через OAuth 2.0 и базовые операции с таблицами.

## Что нужно сделать

### 1. Создать файл сервиса

**Файл:** `dashboard/api/services/GoogleSheetsService.php`

### 2. Реализовать класс GoogleSheetsService

**Namespace:** `Dashboard\Services`

**Основные методы:**

#### `__construct()`
- Инициализация Google Client
- Настройка OAuth 2.0 параметров из переменных окружения

#### `authenticate($authCode = null)`
- OAuth 2.0 аутентификация
- Если передан `$authCode`, обменять его на access token
- Если не передан, вернуть URL для авторизации
- Сохранение токена (в сессии или БД)

#### `getSpreadsheet($spreadsheetId)`
- Получить информацию о таблице по ID
- Вернуть метаданные: название, список листов, время последнего изменения

#### `getSheetData($spreadsheetId, $sheetName)`
- Получить данные конкретного листа
- Вернуть массив строк с данными

#### `getSheetsList($spreadsheetId)`
- Получить список всех листов в таблице
- Вернуть массив с информацией о каждом листе (id, название)

#### `isAuthenticated()`
- Проверить, есть ли валидный access token
- Вернуть true/false

---

## Ожидаемые результаты

### Проверка создания класса

- [ ] Файл `GoogleSheetsService.php` создан
- [ ] Класс находится в namespace `Dashboard\Services`
- [ ] Класс можно импортировать без ошибок
- [ ] Конструктор работает без ошибок

### Проверка аутентификации

- [ ] Метод `authenticate()` возвращает URL для авторизации, если токен отсутствует
- [ ] Метод `authenticate($authCode)` успешно обменивает код на токен
- [ ] Токен сохраняется (в сессии или БД)
- [ ] Метод `isAuthenticated()` корректно определяет статус аутентификации

### Проверка работы с API

- [ ] Метод `getSpreadsheet($spreadsheetId)` возвращает данные о таблице
- [ ] Метод `getSheetData($spreadsheetId, $sheetName)` возвращает данные листа
- [ ] Метод `getSheetsList($spreadsheetId)` возвращает список листов
- [ ] Ошибки обрабатываются корректно (недоступная таблица, нет прав доступа)

### Проверка обработки ошибок

- [ ] При отсутствии credentials выбрасывается понятное исключение
- [ ] При невалидном spreadsheet_id выбрасывается исключение
- [ ] При отсутствии доступа к таблице выбрасывается исключение
- [ ] Все исключения логируются

---

## Связанные файлы

- `dashboard/api/services/GoogleSheetsService.php` - основной файл сервиса
- `dashboard/api/services/DatabaseService.php` - для работы с БД (если нужно хранить токены)

---

## Примечания

- Использовать Google_Client и Google_Service_Sheets из установленного пакета
- Токены можно хранить в сессии или в отдельной таблице БД
- Учесть refresh token для автоматического обновления access token
